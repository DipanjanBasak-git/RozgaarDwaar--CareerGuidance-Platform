<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data:; img-src 'self' https: data:; style-src 'self' 'unsafe-inline' https:; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; font-src 'self' https: data:; frame-ancestors 'none'; upgrade-insecure-requests">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - RozgaarDwaar</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-left">
                <div class="ministry-logo">
                    <div class="ashoka-chakra">☸</div>
                    <div class="ministry-text">
                        <div>MINISTRY OF SKILL DEVELOPMENT & ENTREPRENEURSHIP</div>
                        <div>GOVERNMENT OF INDIA</div>
                    </div>
                </div>
                <div class="program-logo">
                    <div class="pm-logo">
                        <span class="p-letter">R</span>
                        <span class="m-letter">D</span>
                    </div>
                    <div class="program-text">
                        <div>RozgaarDwaar</div>
                        <div>EMPOWERING YOUTH</div>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button class="btn-login" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i>
                    Home
                </button>
            </div>
        </div>
    </header>

    <section class="page-hero">
        <div class="container">
            <div class="hero-content">
                <div>
                    <h1>Sign in to <span class="highlight">RozgaarDwaar</span></h1>
                    <p>Log in with your basic details. You can also upload your resume to autofill and get matched jobs instantly.</p>
                </div>
            </div>
        </div>
    </section>

    <main class="main-content" style="padding:40px 0;">
        <div class="container">
            <div class="login-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:30px;max-width:1000px;margin:0 auto;">
                <div class="login-card" style="background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.08);padding:30px;">
                    <h2 class="section-title" style="margin-bottom:20px;">Login</h2>
                    <div class="form-group">
                        <label>User Type</label>
                        <div class="segmented-toggle" id="userTypeToggle" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                            <select id="loginUserType" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;">
                                <option value="Student">Student</option>
                                <option value="University / Institution (TPO)">University / Institution (TPO)</option>
                                <option value="ULB / Smart City / Parastatal">ULB / Smart City / Parastatal</option>
                                <option value="ULB / Smart City – Department">ULB / Smart City – Department</option>
                                <option value="Rural Department">Rural Department</option>
                                <option value="Employer (MSME, DM, NGO, PSU)">Employer (MSME, DM, NGO, PSU)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="loginName" placeholder="Your full name">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" placeholder="you@example.com">
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="loginPhone" placeholder="+91 ...">
                    </div>
                    <div class="form-group">
                        <label>Current Degree / Course</label>
                        <input type="text" id="loginDegree" placeholder="e.g., B.Tech CSE (Ongoing)">
                    </div>
                    <div class="form-group">
                        <label>Aspiration Role</label>
                        <input type="text" id="loginAspiration" placeholder="e.g., Aspiring Software Engineer">
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="loginLocation" placeholder="City">
                    </div>
                    <button class="btn-primary" id="loginSubmit"><i class="fas fa-sign-in-alt"></i> Continue</button>
                </div>

                <div class="login-card" style="background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.08);padding:30px;">
                    <h2 class="section-title" style="margin-bottom:20px;">Or Upload Resume</h2>
                    <div class="upload-area" id="resumeUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag & drop resume or click to browse</p>
                        <input type="file" id="loginResumeFile" accept=".pdf,.doc,.docx" style="display:none;">
                        <button class="btn-browse" id="loginBrowse">Browse Files</button>
                    </div>
                    <div class="upload-info">
                        <p><strong>Supported formats:</strong> PDF, DOC, DOCX • <strong>Max:</strong> 5MB</p>
                    </div>
                    <div id="parsedSkills" class="ats-recommendations" style="display:none;"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="site-info">
                <div class="copyright">© 2024 RozgaarDwaar</div>
            </div>
        </div>
    </footer>

    <script src="js/ats.js"></script>
    <script>
    (function(){
        function fillProfileFromParsed(parsed){
            if (!parsed) return;
            document.getElementById('loginName').value = parsed.name || '';
            document.getElementById('loginEmail').value = parsed.email || '';
            document.getElementById('loginPhone').value = parsed.phone || '';
            document.getElementById('loginDegree').value = parsed.education || '';
            document.getElementById('loginLocation').value = parsed.location || '';
        }

        function simpleParseResume(text){
            const nameMatch = text.match(/Name[:\-]?\s*(.*)/i);
            const emailMatch = text.match(/[\w.+-]+@\w+\.[\w.-]+/);
            const phoneMatch = text.match(/\+?\d[\d\s-]{8,}/);
            const eduMatch = text.match(/(B\.?(Tech|Com|Sc)|M\.?(Tech|BA|Sc|CA)|MBA|BCA|MCA)[^\n]*/i);
            const locMatch = text.match(/Location[:\-]?\s*([A-Za-z ]{3,})/i);
            return {
                name: nameMatch ? nameMatch[1].trim() : '',
                email: emailMatch ? emailMatch[0] : '',
                phone: phoneMatch ? phoneMatch[0] : '',
                education: eduMatch ? eduMatch[0] : '',
                location: locMatch ? locMatch[1].trim() : ''
            };
        }

        function readFileAsText(file){
            return new Promise((resolve,reject)=>{
                const reader = new FileReader();
                reader.onload = e => resolve(String(e.target.result));
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        const browse = document.getElementById('loginBrowse');
        const input = document.getElementById('loginResumeFile');
        const area = document.getElementById('resumeUploadArea');
        const result = document.getElementById('parsedSkills');

        browse.addEventListener('click', ()=> input.click());
        area.addEventListener('click', (e)=>{ if (e.target === area) input.click(); });
        area.addEventListener('dragover', (e)=>{ e.preventDefault(); area.classList.add('drag'); });
        area.addEventListener('dragleave', ()=> area.classList.remove('drag'));
        area.addEventListener('drop', async (e)=>{ e.preventDefault(); area.classList.remove('drag'); if (e.dataTransfer.files[0]) await handleFile(e.dataTransfer.files[0]); });
        input.addEventListener('change', async ()=>{ if (input.files[0]) await handleFile(input.files[0]); });

        async function handleFile(file){
            if (file.size > 5*1024*1024) { alert('File too large (max 5MB).'); return; }
            const text = await readFileAsText(file);
            const parsed = simpleParseResume(text);
            fillProfileFromParsed(parsed);
            // Extract skills using a BERT-based (simulated) extractor
            const skills = bertExtractSkills(text);
            result.style.display = 'block';
            result.innerHTML = `
                <h4>Extracted Skills</h4>
                <ul>${skills.map(s=>`<li>${s}</li>`).join('')}</ul>
            `;
            // Stash skills temporarily in memory for storing on submit
            window.__rd_extracted_skills = skills;
        }

        // Simulated BERT extractor for skills from free text
        function bertExtractSkills(text){
            const vocab = [
                'javascript','typescript','python','java','c++','c#','go','ruby','php','sql','mongodb','mysql','postgres','html','css','react','angular','vue','node','express','django','flask','spring','aws','azure','gcp','docker','kubernetes','git','linux','bash','ml','machine learning','deep learning','nlp','pandas','numpy','scikit-learn','tensorflow','pytorch','tableau','power bi'
            ];
            const t = text.toLowerCase();
            const found = new Set();
            vocab.forEach(k => { if (t.includes(k)) found.add(k.replace(/\b\w/g,m=>m.toUpperCase())); });
            return Array.from(found).slice(0, 40);
        }

        document.getElementById('loginSubmit').addEventListener('click', () => {
            // Mock login: store minimal profile and redirect to home jobs section
            const profile = {
                name: document.getElementById('loginName').value,
                email: document.getElementById('loginEmail').value,
                phone: document.getElementById('loginPhone').value,
                education: document.getElementById('loginDegree').value,
                location: document.getElementById('loginLocation').value,
                aspiration: document.getElementById('loginAspiration').value,
                skills: Array.isArray(window.__rd_extracted_skills) && window.__rd_extracted_skills.length ? window.__rd_extracted_skills : [],
                userType: document.getElementById('loginUserType').value
            };
            localStorage.setItem('rd_user_profile', JSON.stringify(profile));
            window.location.href = 'index.html#find-jobs';
        });
    })();
    </script>
</body>
</html>

